<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Tallercico de ELK en local</title>

		<meta name="description" content="Solo la parte divertida de montar un sistema ELK y alimentarlo para realizar pequeñas inversitagiones o visualizaciones">
		<meta name="author" content="Carlos Peñas">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/night.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
        <section>
          <h1>Taller de ELK</h1>
          <h4>Va de montar un stack ELK en 127.0.0.1 y empujarle unos logs, para fardar con los amigos</h4>
        </section>
        <section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el1.png">
          </section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el2.png">
          </section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el3.png">
          </section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el4.png">
          </section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el5.png">
          </section>
          <section data-transition-speed="fast" data-background-transition="none" data-background="img/el6.png">
          </section>
          <section data-background-transition="zoom" data-background="img/money.png">
          </section>
        </section>
        <section>
          <h1><font color="lightgreen">E</font>lasticSearch</h1>
          <p>You Know, for Search</p>
        </section>
        <section>
          <p>De elastic search ya sabemos todos bastante no?</p>
          <pre><code data-trim "bash">
wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.4.4.tar.gz
tar -vxzf elasticsearch-1.4.4.tar.gz
cd elasticsearch-1.4.4
echo cluster.name: cluster$RANDOM | tee -a config/elasticseach.yml
bin/elasticsearch
          </code></pre>
          <p><strong>Importante</strong>: Cada version de Logstash lleva asociada una version de elasticsearch en en este caso lo recomendable sería bajar la 1.4.2 pero kibana 4 necesita la 1.4.4 para funcionar. Actualmente vamos por la 1.5.2</p>
        </section>
        <section>
          <h1><font color="#806517">L</font>ogstash</h1>
          <p>Esta es la parte guapa (para sysadmins)<p>
        </section>
        <section>
          <p>Logstash es un colector, transformador y transportador de logs</p>
          <pre><code data-trim "bash">
wget https://download.elastic.co/logstash/logstash/logstash-1.4.2.tar.gz
tar -vxzf logstash-1.4.2.tar.gz
cd logstash-1.4.2
          </code></pre>
          </p>Logstash está escrito en JRuby, dispone de un lenguaje de configuración mas o menos complejo y un sistema de plugins basado en entradas, filtros y salidas y codecs que basicamente trabajan con JSONes</p>
          <h4>Test It!</h4> 
          <pre><code data-trim>
bin/logstash -e 'input { stdin { } } output { stdout { codec => rubydebug } }'
</code><pre>
        </section>
        <section>
          <h3>Configuración</h3>
          <p>La configuración de elastic se basa en tres secciones entradas filtros y salidas, en cualquier seccion puede haber multiples de cada, siempre en ese oden. Ojo! cada plugin es uno o mas procesos de java esperando a ser puestos a currar</p>
        <h4>Referencias a campos e interpolacion de cadenas</h4>
        <p> Se puede hacer referencia a campos y usarlos dentro de cadenas</p>
        <code>add_tag => "hello %{[custom][greting]}"</code>
        <p>Se pueden hacer bloques condicionales it else if else</p>
        <p>estos bloques soportan las operaciones 
        <code>== != < > <= >=, =~ !~, in, not in, and or nand xor y !</code>
        </section>
        <section>
          <h2>Entradas interesantes</h2>
        </section>
        <section>
          <h2>Entradas "raw"</h2>
          <h4>stdin, file, tcp / udp, unix socket </h4>
          <p>Son entradas que permiten capturar lineas de log, stdin se usa sobre todo como sistema de debug para ir pegando en consola lineas de log y ver como se van comportando nuestros filtros</p>
          <p>TCP y file ya son tipos de entrada mas serios, y preparados para produccion, en el caso de file, el plugin de entrada es capaz de detectar rotados truncados etc, y actua como un <code>tail -f</code> sobre un fichero</p>
        </section>
        <section>
          <h2>Entradas "buffer"</h2>
          <p>Son tipos de entrada que capturan eventos desde sistemas intermedios pensados para servir de buffer para la entrada</p> 
          <ul>
            <li>Ammazon SQS</li>
            <li>Redis</li>
            <li>RabbitMQ</li>
          </ul>
        </section>
        <section>
          <h2>Plugins de entrada especializados</h2>
          <ul>
            <li>XMPP: Captura eventos de streams jabber</li>
            <li>Varnishlog: Captura eventos de un log de varnish local</li>
            <li>Twitter: Captura tweets de una array de keywords facilitado</li>
            <li>Syslog: Actua como un servidor de syslog</li>
            <li>S3: lee cualquier fichero que se deposite en un bucket, descomprimiendolo si fuere menester </li>
            <li>Log4j: Crea un puerto TCP al que se puede conectar cualquier cosa compatible con log4j</li>
            <li>IRC: Lee eventos de un servidor IRC</li>
            <li>IMAP: Lee correos enteros, manda a la papelera los que procesa </li>
            <li>Heroku: Lee logs de una app de heroku, como cuando se consultan con el heroku toolbelt</li>
            <li>Eventlog: Lee logs de un log de eventos de m$</li>
            <li>Drupal_dblog: Lee eventos del drupal watchdog, consultando periodicamnte mysql y marcando en la bdd si estan procesados o no</li>
          </ul>
        </section>
        <section>
          <h2>Salidas interesantes</h2>
        </section>
        <section>
         <h2>Obviamente ElasticSearch</h2>
         </p>Es la salida as testada y sin ella tiene poco sentido hablar de stack ELK ya que kibana solo funciona sobre ES.</p>
         <p>Para nuestro setup es importante indicarle el nombre del cluster.</p>
        </section>
        <section>
          <h2>Filtros interesantes</h2>
          mutate
          date
          grok
          useragent
          geoip
        </section>
        <section>
          <h1><font color="blue">K</font>ibana</h1>
          <p>Esta es la parte guapa (para el resto)</p>
        </section>
        <section>
          <p>Kibana es una applicacion web para consultar Elasticsearch</p>
          <p>Está hecha en Node</p>
          <pre><code data-trim "bash">
wget https://download.elastic.co/kibana/kibana/kibana-4.0.2-linux-x64.tar.gz
tar -vxzf kibana-4.0.2-linux-x64.tar.gz
cd kibana-4.0.2
bin/kibana
          </code></pre>
          <p> De kibana no hay slides como mejor se ve es <a href="http://localhost:5601">funcionando</a>
        </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
